<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Socket.IO chat</title>
    </head>
    <body>
        <ul id="messages"></ul>
        <form id="form" action="">
            <input id="input" autocomplete="off" /><button>Send</button>
        </form>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const uri = window.location.href;
                const searchParams = new URLSearchParams(window.location.search);
                const colValue = searchParams.get('col');
                const remValue = searchParams.get('rem');
             
             console.log(remValue);


                console.log("El valor del parámetro 'col' es:", colValue);

                let counter = 0;

                const socket = io({
                    auth: {
                        col: colValue,
                        rem: remValue
                    }
                });

                const form = document.getElementById('form');
                const input = document.getElementById('input');
                const messages = document.getElementById('messages');

                // Función para agregar un mensaje al DOM
                function addMessageToDOM(msg) {
                    const item = document.createElement('li');
                    item.textContent = msg;
                    messages.appendChild(item);
                    window.scrollTo(0, document.body.scrollHeight);
                }

                // Evento para manejar mensajes recibidos del servidor
                socket.on('message', (msg) => {
                    console.log('Mensaje recibido del servidor:', msg);
                    addMessageToDOM(msg); // Agregar mensaje al DOM
                });

                // Evento para manejar mensajes recuperados
                socket.on(colValue, (msg) => {
                    console.log('Mensaje recuperado del servidor:', msg);
                    addMessageToDOM(msg); // Agregar mensaje al DOM
                });

                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (input.value) {
                        const clientOffset = `${socket.id}-${counter++}`;
                        socket.emit('message', input.value, clientOffset, () => {
                            console.log('Mensaje enviado al servidor:', input.value);
                        });
                        input.value = '';
                    }
                });
            });
        </script>
    </body>
</html>
